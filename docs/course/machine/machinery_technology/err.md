# 误差分析计算
## 定位误差分析 P158
### 基准类型
#### 设计基准
即在设计图上采用的基准  
对于几何公差, 即图纸上规定的公差基准  
对于定位尺寸的尺寸界限, 一侧为被约束的平面, 另一侧即该平面的设计基准  
对于直径尺寸, 该直径所过的圆心所在的中心线即设计基准

#### 工序基准
即在工序图上采用的基准, 是加工工序的起点  
获取方法与[设计基准](#设计基准)相同

#### 定位基准
即被夹具确定的几何要素  
如 V 型块确定接触圆弧的圆心, 点接触确定接触点的位置  

### 定位误差分析
同批零件在夹具中定位时, 工序基准位置在工序尺寸方向或沿加工==要求方向==上的==最大变动量==
因此在分析后, 要将误差投影到加工方向才能得到要求的定位误差  
通过比较特定尺寸取上下极限的方法确定误差值

定位误差根据成因可分为基准不重合导致的定位误差 $\Delta_{bc}$ 与基准位置误差导致的定位误差 $\Delta_{jw}$  

### 基准不重合导致的定位误差
![](./src/err_bc.drawio.svg)

当定位基准与工序基准不重合时, 两基准相对位置的最大变动量为 $\Delta_{bc}$  
误差的大小即定位基准与工序基准距离的公差  

对于图示左侧的情况, 两基准距离为半径 $\frac{d}{2}$, 因此有定位误差 $\Delta_{bc}=\frac{T_d}{2}$  
对于图示右侧的情况, 两基准距离为即零件上的尺寸 $L$, 因此有定位误差 $\Delta_{bc}=T_L$

### 基准位置误差导致的定位误差
![](./src/err_jw.drawio.svg)

当定位基准随工件某一特征变动时, 定位基准的最大变动量为 $\Delta_{jw}$  
分别计算该特征取最大值与最小值时基准相对特定绝对位置的距离, 将两个距离相减得到 $\Delta_{jw}$  

* 对于图示左侧的情况, $\Delta_{jw}=\overline{O_{\max}O_{\min}}$  
计算时可以 V 型块的下顶点 $M$ 为参考绝对位置, 分别计算两个基准相对 $M$ 的距离
$$\begin{split}
\overline{OM}&=\frac{\overline{ON}}{\sin(\alpha/2)}=R\frac{1}{\sin(\alpha/2)}\\
\Delta_{jw}&=\frac{d_{\max}-d_{\min}}{2}\frac{1}{\sin(\alpha/2)}=\frac{T_d}{2\sin(\alpha/2)}
\end{split}$$

* 对于图示右侧的情况, $\Delta_{jw}=\overline{N_{\max}N_{\min}}$  
计算时可以点 $M$ 在定位点在水平线的垂足 $H$ 为参考绝对位置, 分别计算两个基准相对 $H$ 的距离
$$\begin{split}
\angle MN_{1}N_{2}=\alpha_{\min}\quad&\angle MN_{2}N_{1}=180^\circ-\alpha_{\max}\\
\overline{N_1H}=h\cot\alpha_{\min}\quad&\overline{N_2H}=-h\cot\alpha_{\max}\\
\overline{N_1N_2}=\overline{N_1H}-\overline{N_2H}&=h(\cot\alpha_{\min}+\cot\alpha_{\max })
\end{split}$$

### 定位误差计算
![](./src/err_dw.drawio.svg)

计算定位误差时, 不能直接将 $\Delta_{bc}$ 与 $\Delta_{jw}$ 相加  
当 $\Delta_{bc}$ 与 $\Delta_{jw}$ 相关时, 还需要判断两者的方向, 当两者方向相反时则需要相减

如图所示, 分析时将 $d=d_{\min}$ 的情况视为理想位置, $d=d_{\max}$ 的情况视为最大误差位置, 此时  
$\Delta_{bc}$ 的方向随工艺基准的位置改变 (保持为定位基准指向工艺基准), $\Delta_{jw}$ 方向与大小不变 (理想基准指向最大误差基准)  
因此对于图示的三个基准, 定位误差 $\Delta_{dw}$ 不同

计算注意
* 当 $\Delta_{bc}$ 与 $\Delta_{jw}$ 有多个独立的来源时, 则可以分开分别计算 $\Delta_{dw}$, 然后相加
* 计算时不要混淆 $\Delta_{bc}$ (==定位与工序基准==之间距离的公差, 如上例中的==半径公差==) 与 $\Delta_{jw}$ (两极限位置下==定位基准==的距离, 如上例中的==圆心距离==)
* 注意计算 $\Delta_{bc}$ 与 $\Delta_{jw}$ 时, 还应==投影到工序尺寸方向==上, 如下图所示, $\Delta_{jw}$ 与工序尺寸方向垂直, 因此对于定位误差没有影响

![](./src/err_dw_appendix.drawio.svg)

## 加工误差统计分析 P290
### 加工误差的性质
#### 系统误差
大小方向保持不变或按一定规律变化的误差称为系统误差

#### 随机误差
大小与方向的变化是随机的误差称为随机误差

### 统计术语
#### 样本与样本容量
从成批加工的零件中抽取一部分零件用于检测  
称被抽取的零件为样本, 被抽取的零件数为样本容量 $n$

#### 样本统计量
* 样本均值  
$$\bar{x}=\frac{1}{n}\sum_{i=1}^{n}x_i$$
* 样本标准差 (总体标准差的无偏估计)  
$$S=\sqrt{\frac{1}{n-1}\sum_{i=1}^{n}(x_i-\bar{x})^2}$$
* 样本极差
$$R=x_{\max}-x_{\min}$$

#### 分组统计
通过分组统计, 绘制实验分布图, 首先要选择合适的组数 $k$ (查表)  
当分组过多, 分布图将因随机波动歪曲, 当分组过少, 分布特征将被掩盖

根据组中值确定分组以及各分组两侧的组界  
分组时要求 $x_{\max},x_{\min}$ 都需要作为一个组中值, 因此最大与最小组界将超出样本范围一个组距 $d$  
因此组距满足
$$d=\frac{R+d}{k}=\frac{R}{k-1}$$

各个组中值满足
$$x_{mi}=x_{\min}+(i-1)d$$

#### 频率与频数
将同一组中的零件个数称为频数 $m_i$  
频数与样本容量之比为频率 $f_i=m_i/n$  

将频率除以组距, 得到不受分组影响的频率密度, 并得到频率密度直方图, 用于与理论分布曲线比较

### 正态分布特点
$$y=\frac{1}{\sigma\sqrt{2\pi}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$

#### 正态分布参数
* 总体平均值 $\mu$  
该参数使用样本平均值 $\bar{x}$ 估计  
正态分布概率密度函数相对 $x=\mu$ 对称  
决定了分布曲线沿横坐标的位置

* 总体标准差 $\sigma$  
该参数使用样本标准差 $S$ 估计  
由于 $P(x<3\sigma|x>3\sigma)\approx 0$, 认为随机变量的最大分散范围即 $[\mu-3\sigma,\mu+3\sigma]$  
决定了随机变量取值的集中程度 (越小越集中)

#### 正态分布曲线
* 分布曲线的顶点  
正态分布曲线在 $x=\mu$ 取得最大值 $\approx \frac{0.4}{\sigma}$  
因此分布曲线的顶点为 $(\mu,\frac{0.4}{\sigma})$

* 分布曲线的拐点  
正态分布曲线在 $x=\mu\pm\sigma$ 由上凸变为下凹, 取值满足 $\approx \frac{0.24}{\sigma}$  
因此分布曲线的左右各一个拐点为 $(\mu\pm\sigma,\frac{0.24}{\sigma})$

* 正态分布曲线的绘制
    1. 标出顶点 $(\mu,\frac{0.4}{\sigma})$
    1. 标出两个拐点 $(\mu\pm\sigma,\frac{0.24}{\sigma})$  
    1. 认为曲线端点为 $(\mu\pm 3\sigma,\approx 0)$
    1. 连接上述五个点得到正态分布曲线

#### 标准正态分布
* 非标准正态分布的转换  
规定满足 $\mu=0,\sigma=1$ 的为标准正态分布     
通过坐标变换, 令 $z=\frac{x-\mu}{\sigma}$ (证明略, 注意 $\mathrm{d}x=\sigma\mathrm{d}z$)  
可将非标准正态分布的随机变量 $x$ 转换为标准正态分布的随机变量 $z$  

* 标准正态分布曲线下的面积函数 $F(z)$  
现规定标准正态分布曲线下的面积函数 $F(z)$ 为标准正态分布密度函数以 $z=\mu=0$ 为下限的积分  
根据正态分布的对称性可得 $F(z)=F(-z)$  
可通过查表获取 $F(z)$ 的值, 其理论计算满足 
$$F(z)=\frac{1}{\sqrt{2\pi}}\int_0^z e^{-\frac{x^2}{2}}\mathrm{d}x$$

* 正态分布随机变量的概率求取  
通过 $F(z)$ 可求取有关正态分布随机变量 $x$ 的概率
    * $P(x>a)=0.5-F(\frac{a-\mu}{\sigma}),a>\mu$
    * $P(x<b)=0.5-F[-(\frac{b-\mu}{\sigma})],b<\mu$
    * $P(b<x<a)=F(\frac{a-\mu}{\sigma})+F[-(\frac{b-\mu}{\sigma})],a>\mu,b<\mu$

### 工序能力与不合格率
#### 工序能力
定义工序能力 $C_p$ 评价工序能满足加工精度的程度
$$C_p=\frac{T}{6\sigma}$$

仅当 $C_p>1$ 表明工序中绝大部分的工件均能满足公差 $T$ 的要求 (加工误差范围小于公差范围), 工序能力足够  
当 $C_p<1$ 表明工序能力不足, 不合格品无法避免

#### 不合格率
* 不合格率  
不合格率 $Q$ 即工序加工后, ==工件尺寸超出公差带的概率==  
通过估计得到工件尺寸 (偏差) 的理论正态分布后, 可用于分析工序的不合格率  
因此不合格率满足 (假设 $x$ 代表轴的偏差) 
$$Q=P(x<ei|x>es)=1-F(\frac{es-\mu}{\sigma})-F[-(\frac{ei-\mu}{\sigma})]$$

* 可修复不合格率 $Q_{\text{可}}$  
当在与加工方向相反的方向超出公差带, 则可通过后续加工修正, 将这部分不合格率称为可修复合格率  
$$Q_{\text{可}}=P(x_{\text{轴}}>es)\quad Q_{\text{可}}=P(x_{\text{孔}}<EI)$$

* 不可修复不合格率 $Q_{\text{不可}}$  
当在加工方向上超出公差带, 无法通过后续加工修正, 将这部分不合格率称为不可修复合格率  
$$Q_{\text{不可}}=P(x_{\text{轴}}>ei)\quad Q_{\text{不可}}=P(x_{\text{孔}}<ES)$$

### 加工质量改进措施
#### 控制分散中心
当尺寸均值与公差带中心相差过大时, 表明保持不变的系统误差占主导  
$$\mu\approx\bar{x}\neq\frac{es+ei}{2}$$
可通过控制分散中心 $\mu$, 通过调整机床使其靠近公差带中心 $\frac{es+ei}{2}$ 提升加工质量

#### 减小分散范围
当尺寸变动范围 $6\sigma$ 大于公差时, 表明变化的系统误差或随机误差占主导  
$$\sigma\approx S> T$$
可通过控制分散程度 $\sigma$, 通过调整工艺参数与使用更高级的机床提升加工质量
