# 操作臂运动学
## 连杆参数与坐标系
![](./src/ch3_rod.drawio.svg)

在实际情况的操作臂中, 连杆可能是一个弯曲杆, 而关节具有复杂形状  
但在建模时, 总将先提取出关节的**轴线** (Axis) 为一条无限长的直线, 即操作臂旋转副 (Revolute Joint) 的转轴或平动副 (Prismatic Joint) 的平动方向  
然后使用以下方法定义建模关节与连杆
* 定义基座开始的第一个轴线 $1$ 到末端的每个轴线依次编号至最后一个轴线 $n$
* 定义**连杆** (Rod) 为一条有限长的线段 (或一个点), 连杆 $i-1$ 为轴线 $i-1$ 与轴线 $i$ 间的公垂线, 共有 $0\sim n$ 个关节  
    * 最后一个轴线 $n$ 上的连杆 $n$ 则根据末端执行器要求定义
    * 有时定义基座为连杆 $0$, 其另一端点为与底面的固连点
* 规定**关节** (Joint) 为一个点, 关节 $i-1$ 为轴线 $i-1$ 与连杆 $i-1$ 的交点, 共有 $1\sim n$ 个关节 

注意, 以上建模产生的操作臂模型仅实际操作臂的轴线信息, 并不一定反应实际的关节与连杆

### 连杆坐标系
一般情况下通过如下方式规定==连杆 $i-1$ 的坐标系==
* 原点为关节 $i-1$ 的所在点
* $z$ 轴与轴线 $i-1$ 共线, 正方向可任意规定, 可先选择方便建模的一侧为正, 最后根据电机正转方向调整
* $x$ 轴与连杆 $i-1$ 共线, 以关节 $i-1$ 所在点指向关节 $i$ 所在点为正
* $y$ 轴通过 $z$ 轴到 $x$ 轴的右手定则确定

称连杆 $i-1$ 的坐标系为 $\{i-1\}$, 其中基座坐标系为 $\{0\}$

### 连杆参数
首先通过[运动的方式描述坐标系之间的联系](./ch1.md#通过运动描述位姿)  
即通过坐标系 $\{i-1\}$ 运动到坐标系 $\{i\}$ 的运动描述连杆参数
1. 绕运动坐标系 $x$ 轴正方向旋转角度 $\alpha_{\red{i-1}}$, 有运动算子 $\space^{b}\bm{R}(x, \alpha_{\red{i-1}})$, 通过该旋转使 $z$ 轴与轴线 $i$ 平行
1. 沿运动坐标系 $x$ 轴正方向移动距离 $a_{\red{i-1}}$, 有运动算子 $\space^{b}\bm{D}(x, a_{\red{i-1}})$
1. 绕运动坐标系 $z$ 轴正方向旋转角度 $\theta_{\blue{i}}$, 有运动算子 $\space^{b}\bm{R}(z, \theta_{\blue{i}})$, 通过该旋转使 $x$ 轴与连杆 $i$ 平行
1. 沿运动坐标系 $z$ 轴正方向移动距离 $d_{\blue{i}}$, 有运动算子 $\space^{b}\bm{D}(z, d_{\blue{i}})$

在实际中, 以上参数分别有以下含义
* $\alpha_{\red{i-1}}$ 表示轴线 $i-1$ 与 $i$ 之间的夹角, 该参数为一个与操作臂有关的常数
* $a_{\red{i-1}}$ 表示连杆 $i-1$ 的长度, 该参数为一个与操作臂有关的常数
* $\theta_{\blue{i}}$ 表示连杆 $i-1$ 与 $i$ 之间的夹角, 当关节为**旋转副**时, 连杆 $i$ 可绕轴线旋转, 因此是一个变量, 仅存在初始姿态偏置
* $d_{\blue{i}}$ 表示连杆 $i-1$ 与轴线 $i$ 交点与关节 $i$ 的距离, 当关节为**移动副**时, 关节 $i$ 可沿轴线平移, 因此是一个变量, 仅存在初始姿态偏置

以 $\alpha_{\red{i-1}},a_{\red{i-1}},\theta_{\blue{i}},d_{\blue{i}}$ 四个参数为一组, 每组参数都可以描述连杆坐标系 $\{i-1\}\to\{i\}$ 的关联, 对于一个 $n$ 关节的操作臂, 即需要 $n$ 组参数描述  
并使用如下所示的连杆参数表表示

|$\bm{i}$|$\bm{\alpha_{i-1}}$|$\bm{a_{i-1}}$|$\bm{\theta_{i}}$|$\bm{d_{i}}$|变化范围|
|--|--|--|--|--|--|
|$1$|$0$|$0^\circ$|$\theta_1(90^\circ)$|$0$|$-160^\circ\sim 160^\circ$|
|$2$|$430$|$-90^\circ$|$0^\circ$|$d_2(0)$|$0\sim 20$|
|$\dots$|$\dots$|$\dots$|$\dots$|$\dots$|$\dots$|
|$n$|$0$|$90^\circ$|$0$|$0$|$-266^\circ\sim 266^\circ$|

其中
* 编号 $i$ 表明该行参数体现了坐标系 $\{i-1\}\to\{i\}$ 的参数, 或连杆 $i-1$ 的参数
* 对于不随运动改变的常量参数直接填写
* 对于变量参数则使用格式 $\theta_i(\dots)$, 即直接写出符号, 然后在括号内写入初始值
* 必要时可在最后加上该组参数中的变量参数的变化范围

### 操作臂建模的一般方法
$n$ 关节的操作臂建模即找出 $n\times 4$ 个[连杆参数](#连杆参数), 并写成连杆参数表

一般可遵循以下步骤
1. 保证操作臂处于一个整体竖直或仅一处为直角的状态
1. 确定并画出操作臂 $1\sim n$ 号的轴线, 使用双点划线表示, 并在末端编号 $A_{iR/P}$, 其中 $R$ 表示旋转副, $P$ 表示移动副
1. 从坐标系 $\{0\}\to\{n\}$ 依次确定, 并在图上标出 $x,z$ 轴, 以及关节 $i$ 的运动方向及变量参数  
对于坐标系 $i-1$
    * 对于一般情况, 使用[连杆坐标系](#连杆坐标系)的基本定义  
    即以连杆在轴线 $i-1$ 的交点为坐标原点, $z$ 轴沿轴线方向, $x$ 轴沿连杆方向, 以指向轴 $i$ 为正方向
    * 对于轴线 $i-1$ 与 $i$ 相交时, 连杆 $i-1$ 为一个点  
    以交点为坐标系原点, $x$ 轴方向垂直于轴线 $i,i-1$, 即 $\bm{x}_{i-1}=\pm\bm{z_i}\times\bm{z_{i-1}}$
    * 对于轴线 $i-1$ 与 $i$ 平行时, 存在无数条合法的连杆 $i-1$  
    可使用以下两种原则之一选择原点, 坐标轴方向确定同一般情况  
        * 取轴线 $i-1$ 上与实际关节相关联的点为坐标系原点 (尽可能与实际关联原则, 此时 $d$ 根据实际选取)  
        * 取连杆 $i-2$ 在轴线 $i-1$ 上的交点为坐标系原点 (尽可能多参数为 $0$ 原则, 此时 $d_{i-1}=0$)
    * 对于轴线 $i-1$ 与 $i$ 重合时, 存在无数条合法的连杆 $i-1$, 且均为点  
    原点选择原则类似平行的情况, $x$ 轴尽可能与坐标系 $\{i-2\}$ 的 $x$ 或 $z$ 轴平行 (尽可能多参数为 $0,90^\circ$)
    * 对于基座坐标系 $\{0\}$, 可使用以下两种原则之一确定
        * 基座坐标系 $\{0\}$ 与坐标系 $\{1\}$ 重合 (尽可能多参数为 $0$ 原则, 此时第一组参数全为 $0$)
        * 基座坐标系 $\{0\}$ 的原点为轴线 $1$ 与地面的交点, $z$ 轴位于轴线 $1$ 上, $x$ 轴与参考坐标系的 $x$ 或 $z$ 轴平行 (尽可能与实际关联原则, 此时仅 $a_0,\alpha_0=0$)
    * 对于末端坐标系 $\{n\}$, $x$ 轴与坐标系 $\{n-1\}$ 的 $x$ 轴平行, 原点使用以下两种原则之一确定
        * 以连杆 $n-1$ 与轴线 $n$ 的交点为原点 (尽可能多参数为 $0$ 原则, 此时 $d_{n}=0$)
        * 根据实际情况选择轴线 $n$ 上与实际执行器相关联的点为原点 (尽可能与实际关联原则, 此时 $d$ 根据实际选取)
1. 根据坐标轴依次确定各组参数
    1. 单独画出坐标系 $\{i-1\}$ 与 $\{i\}$, 并且在接下来每步尽量画出中间坐标系
    1. 绕运动坐标系 $x$ 轴旋转 $\alpha_{i-1}$, 使其 $z$ 轴与 $z_{i}$ 平行
    1. 沿运动坐标系 $x$ 轴平移 $a_{i-1}$, 使坐标原点移动到轴线 $i$ 上
    1. 绕运动坐标系 $z$ 轴旋转 $\theta_{i}$, 使其 $x$ 轴与 $x_{i}$ 平行
    1. 沿运动坐标系 $z$ 轴平移 $d_i$, 使坐标原点与 $\{i\}$ 重合

简单来说建模应当遵守以下原则
1. 尽量使模型与实际相结合, 如坐标系原点的确定
1. 尽量使参数为 $0$ 或 $90^\circ$, 为上一原则的补充
1. 便于建模原则, 如坐标轴方向的确定


